<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Generar QR WhatsApp</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 40px; }
    #qr-img { margin-top: 20px; max-width: 300px; }
    #status { margin-top: 10px; color: #333; }
    button { padding: 10px 20px; font-size: 16px; margin-right: 10px; }
  </style>
</head>
<body>
  <h2>Generar QR para WhatsApp</h2>
  <button id="gen-btn">Generar QR</button>
  <button id="toggle-btn">Desactivar generación</button>
  <div id="status"></div>
  <img id="qr-img" src="" alt="QR" style="display:none;" />
  <script>
    let qrActive = true;
    document.getElementById('gen-btn').onclick = async function() {
      if (!qrActive) {
        document.getElementById('status').innerText = 'La generación de QR está desactivada.';
        return;
      }
      document.getElementById('status').innerText = 'Solicitando QR...';
      document.getElementById('qr-img').style.display = 'none';
      try {
        const res = await fetch('/qr');
        const data = await res.json();
        if (data.qr) {
          document.getElementById('qr-img').src = data.qr;
          document.getElementById('qr-img').style.display = 'block';
          document.getElementById('status').innerText = 'Escanea el QR con WhatsApp.';
        } else {
          document.getElementById('status').innerText = data.message || 'No se pudo generar el QR.';
        }
      } catch (e) {
        document.getElementById('status').innerText = 'Error al solicitar el QR.';
      }
    };
    document.getElementById('toggle-btn').onclick = function() {
      qrActive = !qrActive;
      this.innerText = qrActive ? 'Desactivar generación' : 'Activar generación';
      document.getElementById('status').innerText = qrActive ? 'Generación de QR activada.' : 'Generación de QR desactivada.';
    };
  </script>
</body>
</html>
